<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aquarium</title>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
      user-select: none;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: url("1.png") center / cover no-repeat fixed;
      cursor: default;
    }

    #scene {
      position: fixed;
      inset: 0;
      overflow: hidden;
    }

    /* –ü–µ—Å–æ–∫ */
    #sand {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      height: 170px;
      background: url("13.png") bottom left / auto 100% repeat-x;
      z-index: 10;
      pointer-events: none;
      filter: drop-shadow(0 -6px 10px rgba(0,0,0,.08));
    }

    /* –î–µ–∫–æ—Ä —Å–Ω–∏–∑—É */
    #decor {
      position: absolute;
      inset: 0;
      z-index: 30;
      pointer-events: none;
    }

    .seaweed {
      position: absolute;
      bottom: 120px; /* —á—É—Ç—å –Ω–∞–¥ –ø–µ—Å–∫–æ–º */
      transform-origin: 50% 100%;
      pointer-events: none;
      opacity: 0.95;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.15));
      animation: sway var(--swayDur) ease-in-out infinite alternate;
    }

    @keyframes sway {
      from { transform: translateX(0) rotate(-2deg); }
      to   { transform: translateX(0) rotate(3deg); }
    }

    #ship {
      position: absolute;
      left: -10px;
      bottom: 95px;
      width: min(520px, 45vw);
      height: auto;
      z-index: 32;
      pointer-events: none;
      filter: drop-shadow(0 16px 24px rgba(0,0,0,.25));
    }

    #mermaid {
      position: absolute;
      right: 10px;
      bottom: 95px;
      width: min(380px, 32vw);
      height: auto;
      z-index: 34;
      pointer-events: none;
      filter: drop-shadow(0 16px 24px rgba(0,0,0,.25));
    }

    /* –°—É–Ω–¥—É–∫ (—Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –º—ã—à–∫—É) */
    #chest {
      position: absolute;
      left: 260px;
      bottom: 115px;
      width: min(220px, 20vw);
      aspect-ratio: 1.2 / 1;
      background: url("11.1.png") center / contain no-repeat;
      z-index: 33;
      pointer-events: auto;
      cursor: pointer;
      filter: drop-shadow(0 14px 22px rgba(0,0,0,.22));
      transition: transform .12s ease;
    }
    #chest:hover {
      background-image: url("11.png");
      transform: translateY(-3px) rotate(-1deg);
    }

    /* –†—ã–±—ã */
    #ocean {
      position: absolute;
      inset: 0;
      z-index: 25; /* –ø–æ–¥ –¥–µ–∫–æ—Ä–æ–º, –Ω–æ –Ω–∞–¥ –ø–µ—Å–∫–æ–º */
    }

    .fish {
      position: absolute;
      will-change: transform;
      cursor: grab;
      touch-action: none; /* –≤–∞–∂–Ω–æ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.22));
    }
    .fish:active { cursor: grabbing; }

    .fish img {
      display: block;
      width: 100%;
      height: auto;
      pointer-events: none;
      will-change: transform;
    }

    .fish .sprite.jump {
      animation: jump 240ms cubic-bezier(.2,.9,.2,1);
    }
    @keyframes jump {
      0%   { transform: translateY(0) scale(1); }
      45%  { transform: translateY(-22px) scale(1.03); }
      100% { transform: translateY(0) scale(1); }
    }

    /* –ü—É–∑—ã—Ä—å–∫–∏ */
    #bubbles {
      position: absolute;
      inset: 0;
      z-index: 50;
      pointer-events: none;
    }
    .bubble {
      position: absolute;
      width: var(--sz);
      height: var(--sz);
      background: url("5.png") center / contain no-repeat;
      opacity: .85;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.18));
      animation: bubbleRise var(--dur) linear forwards;
      will-change: transform, opacity;
    }
    @keyframes bubbleRise {
      from {
        transform: translate3d(0,0,0) scale(.75);
        opacity: .85;
      }
      to {
        transform: translate3d(var(--dx), calc(-1 * var(--rise)), 0) scale(1.2);
        opacity: 0;
      }
    }

    /* –õ—ë–≥–∫–∞—è –≤—É–∞–ª—å */
    .veil {
      position: absolute;
      inset: 0;
      z-index: 5;
      pointer-events: none;
      background:
        radial-gradient(circle at 25% 20%, rgba(255,255,255,.14), rgba(255,255,255,0) 55%),
        radial-gradient(circle at 80% 30%, rgba(255,255,255,.10), rgba(255,255,255,0) 58%);
    }

    /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ */
    .hint {
      position: absolute;
      left: 14px;
      bottom: 14px;
      z-index: 60;
      padding: 10px 12px;
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(6px);
      border-radius: 14px;
      font-size: 14px;
      color: rgba(0,0,0,.75);
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="scene">
    <div class="veil"></div>

    <div id="ocean"></div>
    <div id="bubbles"></div>

    <div id="decor">
      <img id="ship" src="12.png" alt="ship" />
      <div id="chest" title="–°—É–Ω–¥—É–∫"></div>
      <img id="mermaid" src="10.png" alt="mermaid" />
    </div>

    <div id="sand"></div>
    <div class="hint">–°—Ö–≤–∞—Ç–∏ —Ä—ã–±–∫—É –∏ —Ç–∞—â–∏ ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç —Å–º–µ—à–Ω–æ –¥—ë—Ä–≥–∞—Ç—å—Å—è üêüüí®</div>
  </div>

  <script>
    (() => {
      const ocean = document.getElementById("ocean");
      const bubbles = document.getElementById("bubbles");
      const decor = document.getElementById("decor");

      // –í–ê–ñ–ù–û: 1.png –æ—Å—Ç–∞–≤–∏–ª —Ñ–æ–Ω–æ–º. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å 1.png –∫–∞–∫ —Ä—ã–±—É ‚Äî –¥–æ–±–∞–≤—å "1.png" –≤ —ç—Ç–æ—Ç –º–∞—Å—Å–∏–≤.
      const FISH_SPRITES = ["2.png", "3.png", "4.png", "6.png", "7.png", "9.png"];

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      const FISH_COUNT = 16;
      const MIN_SIZE = 140;          // —É–≤–µ–ª–∏—á–∏–ª–∏
      const MAX_SIZE = 290;          // —É–≤–µ–ª–∏—á–∏–ª–∏
      const BASE_SPEED = [18, 55];   // —Å–ø–æ–∫–æ–π–Ω–µ–µ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ

      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
      const rand = (a, b) => a + Math.random() * (b - a);
      const pick = (arr) => arr[(Math.random() * arr.length) | 0];

      let W = window.innerWidth;
      let H = window.innerHeight;

      window.addEventListener("resize", () => {
        W = window.innerWidth;
        H = window.innerHeight;
      });

      // –í–æ–¥–æ—Ä–æ—Å–ª–∏
      function spawnSeaweed() {
        const COUNT = 9;
        for (let i = 0; i < COUNT; i++) {
          const w = document.createElement("img");
          w.className = "seaweed";
          w.src = "8.png";
          const size = rand(120, 260);
          w.style.width = size + "px";
          w.style.left = rand(0, W - size) + "px";
          w.style.bottom = (rand(95, 135)) + "px";
          w.style.setProperty("--swayDur", rand(2.2, 4.2) + "s");
          w.style.opacity = rand(0.7, 1);
          w.style.zIndex = String(31 + (Math.random() < 0.5 ? 0 : 3)); // —á–∞—Å—Ç—å –∑–∞/–ø–µ—Ä–µ–¥ –∫–æ—Ä–∞–±–ª—ë–º
          decor.appendChild(w);
        }
      }
      spawnSeaweed();

      // –ü—É–∑—ã—Ä—ë–∫
      function makeBubble(x, y) {
        const b = document.createElement("div");
        b.className = "bubble";
        const sz = rand(16, 34);
        const dur = rand(1.4, 2.8);
        const dx = rand(-40, 40) + "px";
        const rise = rand(140, 260) + "px";

        b.style.left = (x - sz / 2) + "px";
        b.style.top = (y - sz / 2) + "px";
        b.style.setProperty("--sz", sz + "px");
        b.style.setProperty("--dur", dur + "s");
        b.style.setProperty("--dx", dx);
        b.style.setProperty("--rise", rise);

        bubbles.appendChild(b);
        b.addEventListener("animationend", () => b.remove(), { once: true });
      }

      class Fish {
        constructor() {
          this.el = document.createElement("div");
          this.el.className = "fish";

          this.img = document.createElement("img");
          this.img.className = "sprite";
          this.img.src = pick(FISH_SPRITES);
          this.el.appendChild(this.img);

          this.size = rand(MIN_SIZE, MAX_SIZE);
          this.el.style.width = this.size + "px";

          this.x = rand(0, Math.max(1, W - this.size));
          this.y = rand(0, Math.max(1, H - this.size - 180)); // —á—É—Ç—å –≤—ã—à–µ –¥–Ω–∞

          const sp = rand(BASE_SPEED[0], BASE_SPEED[1]);
          const ang = rand(0, Math.PI * 2);
          this.vx = Math.cos(ang) * sp;
          this.vy = Math.sin(ang) * sp;

          // –∞–≤—Ç–æ–ø–ª–∞–≤–∞–Ω–∏–µ –∫ —Ü–µ–ª–∏
          this.target = { x: rand(0, W), y: rand(0, H * 0.75) };
          this.targetTimer = rand(1.2, 2.4);

          // –ø—É–∑—ã—Ä–∏
          this.bubbleTimer = rand(0.4, 1.2);

          // –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
          this.drag = {
            active: false,
            pointerId: null,
            tx: this.x,
            ty: this.y,
            ox: 0,
            oy: 0,
            lastX: 0,
            lastY: 0,
            lastT: 0,
            vpx: 0,
            vpy: 0
          };

          this.wobbleSeed = rand(0, 1000);

          this.el.addEventListener("pointerdown", (e) => this.onDown(e));
          this.el.addEventListener("pointermove", (e) => this.onMove(e));
          this.el.addEventListener("pointerup",   (e) => this.onUp(e));
          this.el.addEventListener("pointercancel", (e) => this.onUp(e));

          this.el.addEventListener("click", () => {
            // –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ
            this.img.classList.remove("jump");
            void this.img.offsetWidth;
            this.img.classList.add("jump");
          });

          ocean.appendChild(this.el);
        }

        pickNewTarget() {
          this.target.x = rand(0, W);
          this.target.y = rand(0, H * 0.72);
          this.targetTimer = rand(1.1, 2.6);
        }

        onDown(e) {
          if (!e.isPrimary) return;

          this.drag.active = true;
          this.drag.pointerId = e.pointerId;
          this.el.setPointerCapture(e.pointerId);

          // —Å–º–µ—â–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä ‚Üí —Ä—ã–±–∞, —á—Ç–æ–±—ã —Ö–≤–∞—Ç–∞—Ç—å "–∑–∞ –º–µ—Å—Ç–æ", –∞ –Ω–µ –∑–∞ —Ü–µ–Ω—Ç—Ä
          this.drag.ox = e.clientX - this.x;
          this.drag.oy = e.clientY - this.y;

          this.drag.tx = e.clientX - this.drag.ox;
          this.drag.ty = e.clientY - this.drag.oy;

          this.drag.lastX = e.clientX;
          this.drag.lastY = e.clientY;
          this.drag.lastT = performance.now();

          // –Ω–∞ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –ø–æ–¥–Ω–∏–º–∞–µ–º –Ω–∞–¥ –≤—Å–µ–º
          this.el.style.zIndex = "60";
        }

        onMove(e) {
          if (!this.drag.active || e.pointerId !== this.drag.pointerId) return;

          const now = performance.now();
          const dt = Math.max(0.001, (now - this.drag.lastT) / 1000);

          // —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞ (–¥–ª—è "–¥–µ—Ä–≥–∞–Ω—å—è" –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∞—è)
          const dx = e.clientX - this.drag.lastX;
          const dy = e.clientY - this.drag.lastY;
          this.drag.vpx = dx / dt;
          this.drag.vpy = dy / dt;

          this.drag.lastX = e.clientX;
          this.drag.lastY = e.clientY;
          this.drag.lastT = now;

          this.drag.tx = e.clientX - this.drag.ox;
          this.drag.ty = e.clientY - this.drag.oy;
        }

        onUp(e) {
          if (!this.drag.active || e.pointerId !== this.drag.pointerId) return;
          this.drag.active = false;
          this.drag.pointerId = null;

          // –æ—Ç–¥–∞—ë–º —Ä—ã–±–µ —Å–∫–æ—Ä–æ—Å—Ç—å "–±—Ä–æ—Å–∫–∞" (—á—É—Ç—å –ø—Ä–∏–≥–ª—É—à–∞–µ–º)
          this.vx = clamp(this.drag.vpx * 0.12, -220, 220);
          this.vy = clamp(this.drag.vpy * 0.12, -180, 180);

          this.el.style.zIndex = ""; // –æ–±—Ä–∞—Ç–Ω–æ
          this.pickNewTarget();
        }

        update(dt, t) {
          const maxX = Math.max(0, W - this.size);
          const maxY = Math.max(0, H - this.size - 160); // –Ω–µ –Ω—ã—Ä—è–µ–º –≤ –ø–µ—Å–æ–∫

          // –ü—É–∑—ã—Ä—å–∫–∏ (–Ω–µ —Å–ø–∞–º–∏–º –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è)
          this.bubbleTimer -= dt;
          if (!this.drag.active && this.bubbleTimer <= 0) {
            const cx = this.x + this.size * 0.55;
            const cy = this.y + this.size * 0.45;
            makeBubble(cx, cy);
            // —á–µ–º –±—ã—Å—Ç—Ä–µ–µ —Ä—ã–±–∞ ‚Äî —Ç–µ–º —á–∞—â–µ –ø—É–∑—ã—Ä—å–∫–∏
            const speed = Math.hypot(this.vx, this.vy);
            this.bubbleTimer = clamp(rand(0.25, 1.05) - speed * 0.004, 0.12, 1.1);
          }

          if (this.drag.active) {
            // "–ø—Ä—É–∂–∏–Ω–∫–∞" –∫ —Ç–æ—á–∫–µ –∫—É—Ä—Å–æ—Ä–∞ + –¥–µ–º–ø—Ñ–µ—Ä (—ç—Ç–æ –¥–∞—ë—Ç —Å–º–µ—à–Ω–æ–µ –±–æ–ª—Ç–∞–Ω–∏–µ)
            const k = 22.0;      // –∂–µ—Å—Ç–∫–æ—Å—Ç—å –ø—Ä—É–∂–∏–Ω—ã
            const damp = 7.5;    // –¥–µ–º–ø—Ñ–∏—Ä–æ–≤–∞–Ω–∏–µ

            const ax = (this.drag.tx - this.x) * k - this.vx * damp;
            const ay = (this.drag.ty - this.y) * k - this.vy * damp;

            // –¥–æ–±–∞–≤–∏–º "–¥—Ä–æ–∂—å" –æ—Ç —Ä–µ–∑–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π –∫—É—Ä—Å–æ—Ä–∞
            const jitter = Math.hypot(this.drag.vpx, this.drag.vpy);
            const j = clamp(jitter * 0.0006, 0, 1);
            const jx = (Math.sin(t * 34 + this.wobbleSeed) * 55) * j;
            const jy = (Math.cos(t * 29 + this.wobbleSeed) * 35) * j;

            this.vx += (ax + jx) * dt;
            this.vy += (ay + jy) * dt;

            this.x += this.vx * dt;
            this.y += this.vy * dt;
          } else {
            // –∞–≤—Ç–æ–ø–ª–∞–≤–∞–Ω–∏–µ –∫ —Ü–µ–ª–∏
            this.targetTimer -= dt;
            if (this.targetTimer <= 0) this.pickNewTarget();

            const dx = this.target.x - this.x;
            const dy = this.target.y - this.y;
            const dist = Math.hypot(dx, dy) || 1;

            const desiredSpeed = rand(BASE_SPEED[0], BASE_SPEED[1]);
            const dvx = (dx / dist) * desiredSpeed;
            const dvy = (dy / dist) * desiredSpeed;

            const steer = 0.06;
            this.vx += (dvx - this.vx) * steer;
            this.vy += (dvy - this.vy) * steer;

            this.x += this.vx * dt;
            this.y += this.vy * dt;
          }

          // –≥—Ä–∞–Ω–∏—Ü—ã/–æ—Ç—Å–∫–æ–∫
          if (this.x < 0) { this.x = 0; this.vx = Math.abs(this.vx); }
          if (this.x > maxX) { this.x = maxX; this.vx = -Math.abs(this.vx); }
          if (this.y < 0) { this.y = 0; this.vy = Math.abs(this.vy); }
          if (this.y > maxY) { this.y = maxY; this.vy = -Math.abs(this.vy); }

          // –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è + "–≤–æ–ª–Ω–∞"
          const flip = this.vx < 0 ? -1 : 1;

          let rot = clamp(this.vy * 0.12, -12, 12);
          let wobbleY = Math.sin((t + this.wobbleSeed) * 2.2) * 2.0;

          // –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ ‚Äî —Ä—ã–±–∞ —Å–∏–ª—å–Ω–µ–µ –±–æ–ª—Ç–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ-–≤–ª–µ–≤–æ
          let dragSwing = 0;
          let dragSide = 0;
          if (this.drag.active) {
            dragSwing = Math.sin(t * 18 + this.wobbleSeed) * 10;
            dragSide = Math.sin(t * 22 + this.wobbleSeed) * 6;
            rot += dragSwing;
          }

          this.el.style.transform =
            `translate3d(${this.x + dragSide}px, ${this.y + wobbleY}px, 0) scaleX(${flip}) rotate(${rot}deg)`;
        }
      }

      // —Å–æ–∑–¥–∞—ë–º —Ä—ã–±–æ–∫
      const fishes = Array.from({ length: FISH_COUNT }, () => new Fish());

      // —Ü–∏–∫–ª
      let last = performance.now();
      function tick(now) {
        const dt = Math.min(0.033, (now - last) / 1000);
        last = now;
        const t = now / 1000;

        for (const f of fishes) f.update(dt, t);

        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>
